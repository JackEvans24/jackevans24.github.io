<form [formGroup]="form" (ngSubmit)="save()">
    <mat-form-field>
        <mat-label>Game</mat-label>
        <mat-select formControlName="gameId">
            <mat-option *ngFor="let boardGame of boardGamesMap | keyvalue" [value]="boardGame.key">{{ boardGame.value.name }}</mat-option>
        </mat-select>
    </mat-form-field>

    <mat-form-field>
        <mat-label>Choose a date</mat-label>
        <input matInput [matDatepicker]="picker" [max]="maxDate" formControlName="date" (click)="picker.open()">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker disabled="false"></mat-datepicker>
    </mat-form-field>

    <div class="mat-headline mt-4 mb-2 ta-c"><mat-icon>person</mat-icon> Players</div>

    <ng-container formArrayName="players">
        <ng-container *ngFor="let playerForm of selectedPlayers.controls; let i = index">
            <div class="player-score-container" [formGroupName]="i">
                <div class="player-inputs">
                    <mat-form-field class="player-name">
                        <mat-label>Player</mat-label>
                        <mat-select formControlName="id">
                            <mat-option *ngFor="let player of playersMap | keyvalue" [value]="player.key" [disabled]="playerIsSelected(i, player.key)">
                                {{ player.value.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                    <mat-form-field class="player-score">
                        <mat-label>Score</mat-label>
                        <input matInput type="number" formControlName="score">
                    </mat-form-field>
                </div>

                <div class="button-container">
                    <button mat-mini-fab type="button" color="warn" (click)="removePlayer(i)"><mat-icon>delete</mat-icon></button>
                </div>
            </div>
        </ng-container>
    </ng-container>

    <button mat-flat-button class="add-player-button" type="button" color="primary" (click)="addPlayer()">Add player <mat-icon>add</mat-icon></button>

    <div class="ta-c warn my-2">{{error}}</div>

    <div class="flex">
        <a mat-flat-button type="button" routerLink="../../games"><mat-icon>arrow_back</mat-icon> Back</a>

        <span class="flex-spacer"></span>

        <button mat-flat-button type="submit" color="primary">Save <mat-icon>save</mat-icon></button>
    </div>
</form>
